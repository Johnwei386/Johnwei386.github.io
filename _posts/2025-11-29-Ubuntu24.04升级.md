---
layout:     post
title:     Ubuntu24.04升级安装
subtitle:   从Ubuntu18.04升级到Ubuntu24.04
date:       2025-11-29
author:     Johnwei386
header-img: img/post-bg-rwd.jpg
catalog: true
tags:
    - Ubuntu

---

随着人工智能技术的发展，目前还在使用的Ubuntu18.04已经落后了，需要升级到最新的Ubuntu24.04，经过梳理，将原系统备份后，进行了升级，保留原来的home目录的文件，现将升级过程总结一下，方便后续再遇到类似情况时可以参考借鉴。

## 1. 系统升级

#### 1.1 原系统备份

```bash
# 挂载外置硬盘
sudo mkdir -p /mnt/root
# 把待备份的根分区（假设 /dev/sda2）只读挂载
sudo mount -o ro /dev/sda2 /mnt/root
# 若有 EFI、boot 单独分区也挂进来
sudo mount -o ro /dev/sda1 /mnt/root/boot/efi
# 一条命令备份除 /home 外的所有文件, 需保存为一个bash脚本文件来执行
sudo tar --acls --xattrs --xattrs-include='*' \
--exclude='/mnt/root/home' \
--exclude='/mnt/root/proc' \
--exclude='/mnt/root/sys' \
--exclude='/mnt/root/mnt' \
--exclude='/mnt/root/dev' \
--exclude='/mnt/root/run' \
--exclude='/mnt/root/tmp' \
--exclude='/mnt/root/media' \
--exclude='*.sock' \
-czpf /mnt/backup/ubuntu-18.04-full-$(date +%F).tar.gz \
-C /mnt/root .
```

#### 1.2 mysql数据库备份

```bash
mysqldump -u root -p --databases db1 > db1-$(date +%F).sql
```

#### 1.3 安装ubuntu24.04

​		从ubuntu官网下载好ubuntu24.04系统的iso文件后，使用启动盘制作工具将系统ISO镜像文件写进一个优盘，使用这个优盘启动电脑进到ubuntu24.04的系统后，先执行完成原系统备份操作，然后启动安装程序，在分区哪里选择手动分区，首先选择原来系统分区，修改，选中格式化，然后选择原来home目录所在分区，修改，**取消格式化！**然后选择efi分区，这个也要取消格式化，保留原来已经存在的启动信息，然后按流程一步步操作直到安装完成后，重启系统即可。

## 2.软件安装

​		因为不是从18一路升级到24的，安装Ubuntu24成功后需要重新安装一些软件，保证新系统能正常使用。

#### 2.1 安装搜狗输入法

​		搜狗输入法工作在Xorg环境下，需要把Wayland模式禁用下(Wayland是Ubuntu的一种默认图形模式)，编辑`/etc/gdm3/custom.conf`配置文件，将`WaylandEnable=false`的注释去掉即可。

​		搜狗输入法目前是4.2.1版本，仅支持fcitx4，如果系统安装了fcitx5，需要卸载掉，同时卸载掉默认已经安装好的ibus输入法框架，同时安装fcitx，然后安装搜狗输入法。

```bash
# 卸载fcitx5和ibus
sudo apt remove --purge fcitx5* ibus*
apt autoremove && sudo apt autoclean

# 安装fcitx
sudo apt install fcitx

# 迁移fcitx桌面启动文件到自启目录
sudp cp /usr/share/applications/fcitx.desktop /etc/xdg/autostart/

# 安装输入法
sudo dpkg -i sogoupinyin_4.2.1.145_amd64.deb

# 安装qt依赖
sudo apt install libqt5qml5 libqt5quick5 libqt5quickwidgets5 qml-module-qtquick2
sudo apt install libgsettings-qt1
```

安装完成后，重启电脑，然后进到设置-系统-区域与语言-Manage Installed Languages，选择键盘输入法系统是Fcitx4，然后在Fcitx4的配置页面添加搜狗输入法，到此则成功安装搜狗输入法。

**存在的问题：**

安装搜狗输入法后，使用gnome-text-editor编辑器以及修改文件名等操作，都切换不了搜狗输入法，提示报错：

```bash
(gnome-text-editor:13293): Gtk-WARNING **: 21:42:32.648: No IM module matching GTK_IM_MODULE=fcitx found
```

此问题是因为GTK4 与 Fcitx 官方打包的 GTK-IM 模块尚未完成适配，系统里缺「fcitx-immodule for GTK4」，fcitx5是支持gtk4的，但是搜狗输入法目前不支持fcitx5，目前只能等搜狗输入法升级了。

#### 2.2 安装基本编译工具

```bash
# 安装gcc,g++,make
sudo apt install build-essential

# 安装git
sudo apt install git

# 安装cmake
sudo apt install cmake

# 安装proxychains
sudo apt install proxychains
sudo apt install proxychains4
```

#### 2.3 安装wps

没有安装libreoffice软件的话则直接安装wps即可

```bash
# 1. 卸载libreoffice
sudo apt-get remove --purge libreoffice*
sudo apt-get clean
sudo apt-get autoremove
   
# 2. 安装字体
sudo mkdir  /usr/share/fonts/adobe
sudo mkdir /usr/share/fonts/wps
sudo cp adobefonts/*  /usr/share/fonts/adobe/
sudo cp wps_symbol_fonts/*  /usr/share/fonts/wps/
   
# 安装wps
sudo dpkg -i wps-office_12.1.2.23578.AK.preread.sw_542488_amd64.deb
```

#### 2.4 安装cuda+cudnn

下载

> cuda_12.9.1_575.57.08_linux.run
>
> cudnn-linux-x86_64-8.9.7.29_cuda12-archive.tar.xz

编辑/etc/modprobe.d/blacklist-nouveau.conf文件, 文件不存在则新建之, 文件内容如下：

```bash
blacklist nouveau
options nouveau modeset=0
```

进入recovery模式, 选择root, 以root用户开启一个命令行窗口, 执行`cuda_12.9.1_575.57.08_linux.run`来安装cuda，安装完成后会提示去配置PATH和LD_LIBRARY_PATH环境变量，ubuntu24.04在/etc/environment文件中添加全局环境变量，在这个文件进行PATH等环境变量的修改：

```bash
PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/cuda/bin"
LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/usr/local/cuda/lib64"
```

重启后查看cuda是否安装成功：

```bash
# 查看设备
nvidia-smi

# 使用cuda提供的小工具
./usr/local/cuda-12.9/extras/demo_suite/deviceQuery
```

安装cudnn

```bash
sudo cp cuda/include/cudnn.h /usr/local/cuda-12.9/include
sudo cp cuda/lib64/libcudnn* /usr/local/cuda-12.9/lib64
sudo chmod a+r /usr/local/cuda-12.9/include/cudnn.h 
sudo chmod a+r /usr/local/cuda-12.9/lib64/libcudnn*
```

#### 2.5 安装virtualbox

```bash
sudo apt install virtualbox
```

安装完成的virtualbox是7.0.16版的，从oracle网站下载扩展插件进行安装，需要把windows的虚拟机的usb设备调整为3.0，目前2.0的接口存在bug，无法保存快照。

#### 2.6 安装docker

```bash
# 安装基本工具
sudo apt install -y apt-transport-https ca-certificates curl gnupg software-properties-common

# 安装Docker官方源
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
proxychains curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# 安装Docker
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 添加组用户
sudo usermod -aG docker $USER

# 添加/etc/docker/daemon.json配置,文件不存在则创建
sudo touch /etc/docker/daemon.json
sudo nano /etc/docker/daemon.json
{
  "data-root": "/path/to/dockerHub",
  "registry-mirrors": ["https://docker.m.daocloud.io"]
}

# 重启docker
sudo systemctl daemon-reload
sudo systemctl restart docker

# 查看配置是否更新
sudo docker info |grep "Docker Root Dir"
```

#### 2.7 安装mysql

```bash
# 安装
sudo apt install mysql-server mysql-client

# 安全初始化,设置密码强度、禁用远程root等
sudo mysql_secure_installation

# 进入mysql,root用户可直接进入mysql,默认登录root用户
sudo mysql
```

恢复数据

```sql
mysql> source buckup.sql
```

创建用户并授权

```sql
mysql> CREATE USER 'appuser'@'%' IDENTIFIED BY 'Strong@123';
mysql> GRANT ALL PRIVILEGES ON mydb.* TO 'appuser'@'%' WITH GRANT OPTION;
mysql> FLUSH PRIVILEGES;
```

